<div class="container auth-container">
  <h1>회원정보 수정</h1>

  <% if (messages.error && messages.error.length) { %>
    <div class="alert alert-error">
      <% messages.error.forEach(function (msg) { %>
        <p><%= msg %></p>
      <% }) %>
    </div>
  <% } %>

  <% if (messages.success && messages.success.length) { %>
    <div class="alert alert-success">
      <% messages.success.forEach(function (msg) { %>
        <p><%= msg %></p>
      <% }) %>
    </div>
  <% } %>

  <form action="/users/edit" method="POST">
    <div class="form-group">
      <label for="id">아이디</label>
      <input
        type="text"
        id="id"
        name="id"
        value="<%= user.id %>"
        readonly
      />
      <small class="field-help">아이디는 변경할 수 없습니다.</small>
    </div>

    <div class="form-group">
      <label for="name">닉네임</label>
      <input
        type="text"
        id="name"
        name="name"
        value="<%= user.name %>"
        required
      />
      <button type="button" id="btn-check-name" class="btn-secondary">
      중복 확인
    </button>
  </div>
  <small class="field-help">
    닉네임은 다른 사용자의 닉네임과 중복될 수 없습니다.
  </small>
  <div id="nickname-message" style="margin-top:4px; font-size:0.9rem;"></div>  
 </div>

    <div class="form-group">
      <label for="email">이메일</label>
      <input
        type="email"
        id="email"
        name="email"
        value="<%= user.email %>"
        required
      />
<button type="submit" name="action" value="send-code" class="btn-secondary">
        인증코드 보내기
      </button>
      </div>
      <small class="field-help">
        이메일을 변경하려면 먼저 새 이메일로 인증코드를 보내주세요.
      </small>
    </div>

     <!-- 이메일 인증 코드 입력 -->
    <div class="form-group">
      <label for="emailCode">이메일 인증 코드</label>
      <input
        type="text"
        id="emailCode"
        name="emailCode"
        placeholder="인증코드 입력"
      </div>
      
      <small class="field-help">
        이메일을 변경하는 경우, 받은 인증 코드를 입력한 후 "수정 완료"를 눌러주세요.
      </small>
    </div>

    <button type="submit" class="btn-primary">수정 완료</button>
  </form>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const btnCheckName = document.getElementById("btn-check-name");
    const inputName = document.getElementById("name");
    const nicknameMsg = document.getElementById("nickname-message");

    if (!btnCheckName) return;

    btnCheckName.addEventListener("click", function () {
      const name = inputName.value.trim();
      if (!name) {
        nicknameMsg.textContent = "닉네임을 입력해주세요.";
        nicknameMsg.style.color = "red";
        return;
      }

      fetch(`/users/check-name?name=${encodeURIComponent(name)}`)
        .then((res) => res.json())
        .then((data) => {
          nicknameMsg.textContent = data.message;

          if (data.available) {
            nicknameMsg.style.color = "green"; // 사용 가능 → 초록색
          } else {
            nicknameMsg.style.color = "red";   // 중복/오류 → 빨간색
          }
        })
        .catch((err) => {
          console.error(err);
          nicknameMsg.textContent = "오류가 발생했습니다.";
          nicknameMsg.style.color = "red";
        });
    });
  });
</script>

</div>
